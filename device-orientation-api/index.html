<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phone Orientation Visualizer</title>
    <style>
      body {
          margin: 0;
          overflow: hidden;
          font-family: Arial, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      #container {
          width: 100vw;
          height: 100vh;
      }
      #info {
          position: absolute;
          top: 20px;
          left: 20px;
          color: white;
          background: rgba(0, 0, 0, 0.5);
          padding: 15px;
          border-radius: 10px;
          font-size: 14px;
          z-index: 100;
          max-width: 300px;
      }
      #startButton {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          padding: 20px 40px;
          font-size: 18px;
          background: #4CAF50;
          color: white;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          z-index: 200;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }
      #startButton:hover {
          background: #45a049;
      }
      #error {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: white;
          background: rgba(255, 0, 0, 0.8);
          padding: 20px;
          border-radius: 10px;
          display: none;
          z-index: 300;
          max-width: 80%;
          text-align: center;
      }
      .label {
          font-size: 12px;
          color: #ccc;
          margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <div id="info">
      <h3>Device Orientation</h3>
      <div id="orientation">
        <strong>Alpha (Z-axis):</strong> 0°<br />
        <strong>Beta (X-axis):</strong> 0°<br />
        <strong>Gamma (Y-axis):</strong> 0°<br />
        <strong>Absolute:</strong> N/A
      </div>
      <div class="label">
        Rotate your phone to see the cube move!<br />
        <small
          >Alpha: compass direction (0-360°)<br />
          Beta: front-back tilt (-180 to 180°)<br />
          Gamma: left-right tilt (-90 to 90°)</small
        >
      </div>
    </div>
    <button id="startButton">Start Orientation Tracking</button>
    <div id="error"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      let scene, camera, renderer, cube;
      let useOrientation = false;

      // Initialize Three.js scene
      function init() {
        // Scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);

        // Camera
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        // Renderer
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById("container").appendChild(renderer.domElement);

        // Create cube with different colored faces
        const geometry = new THREE.BoxGeometry(2, 2, 2);
        const materials = [
          new THREE.MeshBasicMaterial({ color: 0xff0000 }), // Right - Red
          new THREE.MeshBasicMaterial({ color: 0x00ff00 }), // Left - Green
          new THREE.MeshBasicMaterial({ color: 0x0000ff }), // Top - Blue
          new THREE.MeshBasicMaterial({ color: 0xffff00 }), // Bottom - Yellow
          new THREE.MeshBasicMaterial({ color: 0xff00ff }), // Front - Magenta
          new THREE.MeshBasicMaterial({ color: 0x00ffff }), // Back - Cyan
        ];
        cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);

        // Add edges to make cube more visible
        const edges = new THREE.EdgesGeometry(geometry);
        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 2 }));
        cube.add(line);

        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        // Handle window resize
        window.addEventListener("resize", onWindowResize, false);

        // Start animation loop
        animate();
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);

        if (!useOrientation) {
          // Gentle auto-rotation when not using device orientation
          cube.rotation.x += 0.005;
          cube.rotation.y += 0.005;
        }

        renderer.render(scene, camera);
      }

      // Handle device orientation event
      function handleOrientation(event) {
        // Get orientation values
        const alpha = event.alpha || 0; // Z axis (0-360) - compass direction
        const beta = event.beta || 0; // X axis (-180 to 180) - front to back
        const gamma = event.gamma || 0; // Y axis (-90 to 90) - left to right
        const absolute = event.absolute;

        // Apply rotation to cube
        // Convert degrees to radians and apply to cube
        cube.rotation.set(
          THREE.MathUtils.degToRad(beta), // X rotation
          THREE.MathUtils.degToRad(gamma), // Y rotation
          THREE.MathUtils.degToRad(alpha) // Z rotation
        );

        // Update info display
        document.getElementById("orientation").innerHTML = `
                <strong>Alpha (Z-axis):</strong> ${alpha.toFixed(1)}°<br>
                <strong>Beta (X-axis):</strong> ${beta.toFixed(1)}°<br>
                <strong>Gamma (Y-axis):</strong> ${gamma.toFixed(1)}°<br>
                <strong>Absolute:</strong> ${absolute ? "Yes" : "No"}
            `;
      }

      // Request permission and start orientation tracking
      async function startOrientation() {
        const button = document.getElementById("startButton");
        const errorDiv = document.getElementById("error");

        try {
          // Check if DeviceOrientationEvent is supported
          if (!window.DeviceOrientationEvent) {
            throw new Error("DeviceOrientationEvent is not supported on this device/browser");
          }

          // Request permission for iOS 13+ devices
          if (typeof DeviceOrientationEvent.requestPermission === "function") {
            try {
              const permission = await DeviceOrientationEvent.requestPermission();
              if (permission !== "granted") {
                throw new Error("Permission denied for device orientation");
              }
            } catch (err) {
              throw new Error(`Permission request failed: ${err.message}`);
            }
          }

          // Add event listener for device orientation
          window.addEventListener("deviceorientation", handleOrientation, true);

          useOrientation = true;
          button.style.display = "none";
          errorDiv.style.display = "none";

          console.log("Device orientation tracking started");
        } catch (error) {
          console.error("Error starting orientation tracking:", error);
          errorDiv.innerHTML = `
                    <strong>Error:</strong> ${error.message}<br><br>
                    <small>Make sure you're using HTTPS and your device has orientation sensors.</small><br>
                    <small>Falling back to auto-rotation...</small>
                `;
          errorDiv.style.display = "block";
          button.style.display = "none";

          // Hide error after 5 seconds
          setTimeout(() => {
            errorDiv.style.display = "none";
          }, 5000);
        }
      }

      // Initialize scene when page loads
      init();

      // Add click handler to start button
      document.getElementById("startButton").addEventListener("click", startOrientation);

      // Log when page is loaded
      console.log("Page loaded. Click button to start orientation tracking.");
      console.log("DeviceOrientationEvent supported:", "DeviceOrientationEvent" in window);
      console.log("Permission API available:", typeof DeviceOrientationEvent.requestPermission === "function");
    </script>
  </body>
</html>
